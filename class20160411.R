## ??????
- ???.csv????????????R
```{r}
data <- read.csv('open.csv')
data
```


## ??????
- ???XML????????????R
- `XML`

```{r warning=FALSE,message=FALSE}
library(XML)
fileUrl <- "http://www.w3schools.com/xml/simple.xml"
doc <- xmlTreeParse(fileUrl,useInternal=TRUE)
rootNode <- xmlRoot(doc)
rootNode
```


## ??????
- ???XML????????????R
- ????????????tag??????
```{r explore4}
xpathSApply(rootNode,"//name",xmlValue)#????????????"name"??????????????????
xpathSApply(rootNode,"//price",xmlValue)#????????????"price"??????????????????
```

## ??????
- ??????APIs????????????
- ???JSON????????????R
- `jsonlite`
- `RCurl`
- URL: "http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&rid=190796c8-7c56-42e0-8068-39242b8ec927"
```{r message=FALSE,warning=FALSE}
library(jsonlite)
library(RCurl)
WaterData<-fromJSON(
  getURL("http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&rid=190796c8-7c56-42e0-8068-39242b8ec927"))
head(WaterData$result$results)
```

## ??????
- ??????APIs????????????, ???JSON????????????R
```{r message=FALSE,warning=FALSE}
WaterData<-fromJSON(
  getURL("http://data.taipei/opendata/datalist/apiAccess?scope=resourceAquire&rid=190796c8-7c56-42e0-8068-39242b8ec927"))
head(WaterData$result$results)
```

## ????????????

if (!require('Rfacebook')){
  install.packages("Rfacebook")
  library(Rfacebook)
}
token <- "EAACEdEose0cBAKgx7Ee7VlqwhqCv6QXycRscxFu15iPCUDcERYzP1ZCPt1ZBO1T7fziL2RHs5PgUNuExjlSHRRezcSD3rl6NzzfZCOYEkRDNJH5UozUH2Nc2barPlQ906YiZChBFY8VaFBL69RtRZB9es6ScEIyKbbW9aNiD8VgZDZD"
totalPage<-NULL ##??????
lastDate<-Sys.Date()
DateVector<-seq(as.Date("2016-01-01"),lastDate,by="5 days")
DateVectorStr<-as.character(DateVector)
for(i in 1:(length(DateVectorStr)-1)){
  tempPage<-getPage("tsaiingwen", token,since = DateVectorStr[i],
                    until = DateVectorStr[i+1])
  totalPage<-rbind(totalPage,tempPage)
}


## ?????????????????? totalPage
<img src="Fig/totalPage.png" width="800px">
  
  ## ?????????-??????????????????
  ?????????????????????????????????

totalComment<-NULL
for(i in 1:nrow(totalPage)){ ##????????????.....????????????????????????(1:10)
  post<-getPost(totalPage$id[i],token,
                n.comments = totalPage$comments_count)
  tempComment<-cbind(post$post$id,post$comments$from_name)
  totalComment<-rbind(totalComment,tempComment)
}

  ## totalComment
  
  ```
???????????????There were 50 or more warnings 
(use warnings() to see the first 50)

50: In if (n.comments < 500) { ... :
    the condition has length > 1 and only the first element will be used
  ```
    
    ## ??????
    ```{r eval=FALSE}
  totalComment<-data.frame(totalComment)
  colnames(totalComment)<-c("postID","commentName")
  NameCount<-aggregate(postID~commentName,totalComment,FUN=length)
  head(NameCount[order(NameCount$postID,decreasing = T),],10)
  ```
  ```
  commentName postID
  31055      ?????????   1001
  5349     Gao Gary    879
  13282    Pin Chen    617
  1295     Ben  Hsu    480
  21142      ?????????    443
  29199      ?????????    413
  23378      ?????????    384
  21428        ??????    347
  2471   Cheng Teng    343
  6654  Hui Mei Lin    335
  ```
  

    
    ## ????????????
    
    - R Bloggers ?????????[????????????](http://www.r-bloggers.com/?s=Web+Scraping)????????????
  - [Ptt????????????](http://bryannotes.blogspot.tw/2014/08/r-ptt-wantedsocial-network-analysis.html) 
  - [???????????? ??????????????????](http://www.largitdata.com/course_list/1)
  
  
  ##Other Data
  - MySQL `RMySQL`
  - HDF5 `rhdf5`
  - Weka `foreign`
  - Stata `foreign`
  - SPSS `Hmisc`
  - SAS `Hmisc`
  - GIS `rgdal`
  - Images `jpeg`
  - Music `tuneR`
  
  
  ##???????????????
  - ??????GitHub?????????
  - ???GitHub?????????Git config??????
  - **Clone**??????????????????????????????(????????????)
  + ?????????????????????+?????????**Clone**
    - ?????????*Clone??????????????????*?????????**.Rproj**
    - ??????[???????????????R Code](https://github.com/yijutseng/BigDataCGUIM/blob/master/BigData20160411.Rmd)
  
  # Data Manipulation
  
  ## Start with reshaping
  [http://www.statmethods.net/management/reshape.html](http://www.statmethods.net/management/reshape.html)
  ```{r results='hide',message=FALSE, warning=FALSE}
  if (!require('reshape2')){
    install.packages("reshape2")
    library(reshape2)
  }
  ```
  ```{r reshape2}
  head(mtcars)
  ```
  
  
  ## Melting data frames
  
  ```{r mtcars}
  mtcars$carname <- rownames(mtcars)
  carMelt <- melt(mtcars,id=c("carname","gear","cyl"),
                  measure.vars=c("mpg","hp"))
  head(carMelt,n=3)
  tail(carMelt,n=3)
  ```
  
  ## Casting data frames -1
  
  ```{r }
  cylData <- dcast(carMelt, cyl ~ variable)
  cylData
  ```
  
  ## Casting data frames -2
  [http://www.statmethods.net/management/reshape.html](http://www.statmethods.net/management/reshape.html)
  
  ```{r }
  cylData <- dcast(carMelt, cyl ~ variable,mean)
  cylData
  ```
  
  
  
  ## More information
  - `reshape` [??????](http://www.slideshare.net/jeffreybreen/reshaping-data-in-r)
  - `data.table` [??????](https://www.datacamp.com/community/tutorials/data-table-r-tutorial)
  
  
  # ????????????
  
  ## Principles of Analytic Graphics
  
  - ?????????????????????
  - ?????????????????????????????????
  
  ## ?????????????????????
  install.packages("SportsAnalytics")
  ```{r message=FALSE,warning=FALSE}
  library(SportsAnalytics) #install.packages("SportsAnalytics")
  NBA1415<-fetch_NBAPlayerStatistics("14-15")
  boxplot(Blocks~Position,data=NBA1415)
  ```
  
  ## Principles of Analytic Graphics
  
  - ?????????????????????
  - ?????????????????????????????????
  
  - ?????????????????????causality???,?????????mechanism???,???????????????explanation???,?????????????????????systematic structure???
  - ???????????????????????????????????????????????????
  
  ## ?????????????????????causality???
  <img src="Fig/cau.png" width="800px">
    
    ## Principles of Analytic Graphics
    
    - ?????????????????????
  - ?????????????????????????????????
  
  - ?????????????????????causality???,?????????mechanism???,???????????????explanation???,?????????????????????systematic structure???
  - ???????????????????????????????????????????????????
  
  - ??????????????????Multivariate?????????
  - ????????????Multivariate???????????????????????????????????????
  - ????????????????????????????????????
  
  
  ## ??????????????????Multivariate?????????
  install.packages("ggplot2")
  ```{r message=FALSE, warning=FALSE,fig.height=3.5}
  library(ggplot2) #install.packages("ggplot2")
  qplot(TotalPoints, TotalMinutesPlayed,
        facets = .~Position, data = NBA1415)+
    stat_smooth(method="glm")
  ```
  
  ## ??????????????????Multivariate?????????
  ```{r message=FALSE, warning=FALSE,fig.height=3.5}
  #library(ggplot2) #install.packages("ggplot2")
  qplot(TotalRebounds, TotalMinutesPlayed,
        facets = .~Position, data = NBA1415)+
    stat_smooth(method="glm")
  ```
  
  ## Principles of Analytic Graphics
  - ?????????????????????
  - ?????????????????????????????????????????????????????????
  - ???????????????????????????
  
  ## ?????????????????????
  <img src="Fig/int.png" width="500px">
    
    ## Principles of Analytic Graphics
    - ?????????????????????
  - ?????????????????????????????????????????????????????????
  - ???????????????????????????
  
  - ?????????????????????????????????????????????xy????????????????????????????????????
  - ????????????????????????????????????????????????
  
  
  ## Principles of Analytic Graphics
  - ?????????????????????
  - ?????????????????????????????????????????????????????????
  - ???????????????????????????
  
  - ?????????????????????????????????????????????xy????????????????????????????????????
  - ????????????????????????????????????????????????
  
  - ????????????????????????
  - ??????????????????????????????????????????????????????
  
  Edward Tufte (2006). *Beautiful Evidence*, Graphics Press LLC. [www.edwardtufte.com](http://www.edwardtufte.com)
  
  
  ## ?????????????????????
  
  * To understand data properties
  * To find patterns in data
  * To suggest modeling strategies
  * To "debug" analyses
  * To communicate results
  
  1~4: ????????? (Exploratory graphs)
  
  5: ????????? (Final graphs)
  
  ## ??????????????????
  
  * They are made quickly
  * A large number are made
  * The goal is for personal understanding
  * Axes/legends are generally cleaned up (later)
  * Color/size are primarily used for information
  
  # ???R???????????????Packages
  
  ## ???R?????????Packages
  
  - Base: plot()
  - lattice: `library(lattice)`
  - ggplot: `library(ggplot2)`
  
  ## ???R??????101: Base
  
  * "Artist's palette" model
  * Start with blank canvas and build up from there
  * Start with plot function (or similar)
    * Use annotation functions to add/modify (`text`, `lines`, `points`,
                                              `axis`)
  
  
  ## ???R??????101: Base
  
  * ???????????????????????????????????????????????????????????????
  
  * ????????????????????????????????????????????????????????????????????????????????????
  
  * code??????????????????
  
  * ????????????????????????????????????????????????????????????
  
  
  
  ## Base Plot() ?plot
  
  ```{r,fig.height=3,fig.width=8}
  if (!require('datasets')){
    install.packages("datasets")
    library(datasets)
  }
  data(cars)
  plot(cars$speed, cars$dist)
  ```
  
  
  ## The Lattice System
  
  * ??????????????????function????????? (`xyplot`, `bwplot`,etc.)
  
  * ??????????????????????????????????????????: Looking at how y changes with x across levels of z
  
  * ??????????????????????????????????????????????????????
  
  * ????????????????????????????????????????????????
  
  
  ## The Lattice System
  
  * ?????????????????????????????????????????????????????????
  
  * ???????????????????????????
  
  * ??????????????????????????????????????????
  
  ## Lattice Plot
  
  ```{r,message=FALSE,warning=FALSE}
  if (!require('lattice')){
    install.packages("lattice")
    library(lattice)
  }
  state <- data.frame(state.x77, region = state.region)
  state
  ```
  
  ## Lattice Plot
  library(lattice)
  
  xyplot(Life.Exp ~ Income | region, data = state, layout = c(4, 1))
  
  
  - `Life.Exp ~ Income | region`: y ~ x | block
  - `data`: data frame
  - `layout = c(4, 1)`: 4 columns, 1 row
  
  ## Lattice Plot
  library(lattice)
  
  xyplot(Life.Exp ~ Income | region, data = state, layout = c(2, 2))
  
  - `layout = c(2, 2)`: 2 columns, 2 rows
  
  
  ## The ggplot2 System
  
  * ??????base???lattice???????????????????????????
  
  * ???lattice?????????????????????????????????????????????base???????????????????????????????????????
  
  
  
  ## ggplot2 Plot
  ```{r, message=FALSE,warning=FALSE,fig.height=3,fig.width=6}
  if (!require('ggplot2')){
    install.packages("ggplot2")
    library(ggplot2)
  }
  qplot(Life.Exp, Income,facets = .~region, data = state)
  ```
  
  ## ggplot2 Example 2
  Need `library(ggplot2)`
  ```{r, message=FALSE,fig.height=3.5,fig.width=6}
  data(mpg)
  qplot(displ, hwy, data = mpg)
  ```
  
  
  ## Summary
  
  * Base: ???????????????????????????
  
  * Lattice: ???????????????????????????????????????????????????????????????????????????
  
  * ggplot2: ?????????????????????????????????????????????????????????
  
  
  
  ## References
  - Roger D. Peng & Elizabeth Matsui (2015) *The Art of Data Science*, Leanpub
  - Paul Murrell (2011). *R Graphics*, CRC Press.
  - Hadley Wickham (2009). *ggplot2*, Springer.
  - ????????? [R Visualization - Using ggplot2](https://blog.liang2.tw/2013-RConf-ggplot2-intro/)
  
  # Plotting System--Base
  
  ## Plotting System--Base
  
  - *graphics*: contains plotting functions for the "base" graphing
  systems, including `plot`, `hist`, `boxplot` and many others.
  
  - *grDevices*: contains all the code implementing the various graphics
  devices, including X11, PDF, PostScript, PNG, etc.
  
  
  ## ????????????
  
  ?????????????????????:
    
    - ?????????????????????????????????????????????????????????
  
  - ????????????????????????
  - Is the plot for viewing `temporarily` on the screen?  
  - Will it be presented in a `web browser`?
  - Will it eventually end up in a `paper` that might be `printed`? 
  - Are you using it in a `presentation`?
  
  - ????????????????????????????????????????????????????????????
  
  
  ## Base Graphics
  
  - ???????????????
  - Initializing a new plot
  - Annotating (adding to) an existing plot
  
  - ??? `plot(x, y)` or `hist(x)` ???????????????
  
  - `plot`??????????????????????????????????????????
  
  - ???`?par`????????????????????????????????????????????????
  
  
  
  ## Simple Base Graphics: Histogram
  
  ```{r,fig.height=3.5}
  library(datasets)
  hist(airquality$Ozone)  ## Draw a new plot
  ```
  
  
  
  ## Simple Base Graphics: Scatterplot
  
  ```{r,fig.height=3.5}
  library(datasets)
  with(airquality, plot(Wind, Ozone))
  ```
  
  
  
  ## Simple Base Graphics: Boxplot
  
  ```{r,fig.height=3.5}
  library(datasets)
  airquality <- transform(airquality, Month = factor(Month))
  boxplot(Ozone ~ Month, airquality, xlab = "Month", ylab = "Ozone (ppb)")
  ```#???????????????????????????????????????????????????
  
  
  
  ## ??????????????????- Base
  
  - `pch`: the plotting symbol (default is open circle)
  - `lty`: the line type (default is solid line), can be dashed, dotted, etc.
  - `lwd`: the line width, integer 
  - `col`: the plotting color,  ???`colors()` ???????????????????????????
  - `xlab`: character string for the x-axis label
  - `ylab`: character string for the y-axis label
  
  
  
  
  ## ??????????????????- Base
  
  ??? `par()` function ???????????????????????????
  
  - `las`: the orientation of the axis labels on the plot
  - `bg`: the background color
  - `mar`: the margin size
  - `oma`: the outer margin size (default is 0 for all sides)
  - `mfrow`: number of plots per row, column (plots are filled row-wise) 
  - `mfcol`: number of plots per row, column (plots are filled column-wise)
  
  
  
  ## ??????????????????- Base
  
  Default values for global graphics parameters
  
  ```{r}
  par("lty")
  par("col")
  par("pch")
  ```
  
  
  
  ## ??????????????????- Base
  
  Default values for global graphics parameters
  
  ```{r}
  par("bg")
  par("mar")
  par("mfrow")
  ```
  
  
  
  ## Base Plotting Functions
  
  - `plot`: ??????????????????????????????????????????????????????????????????
  
  - `lines`: ???????????????
  - `points`: ???????????????
  - `text`: ???????????????
  - `title`: add annotations to x, y axis labels, title, subtitle, outer margin 
  - `mtext`: add arbitrary text to the margins (inner or outer) of the plot 
  - `axis`: adding axis ticks/labels
  
  
  
  ## Base Plot with Annotation
  
  ```{r,fig.height=3.5}
  library(datasets)
  with(airquality, plot(Wind, Ozone))
  ## Add a title
  title(main = "Ozone and Wind in New York City")  
  ```
  
  
  
  ## Base Plot with Annotation
  
  ```{r,fig.height=3}
  with(airquality, plot(Wind, Ozone, 
                        main = "Ozone and Wind in NYC"))
  with(subset(airquality, Month == 5), 
       points(Wind, Ozone, col = "blue"))
  ```
  
  
  
  ## Base Plot with Annotation
  
  ```{r,fig.height=3}
  with(airquality, plot(Wind, Ozone, main = "Ozone and Wind in NYC", type = "n"))
  with(subset(airquality, Month == 5), points(Wind, Ozone, col = "blue"))
  with(subset(airquality, Month != 5), points(Wind, Ozone, col = "red"))
  legend("topright", pch = 1, col = c("blue", "red"), 
         legend = c("May", "Other Months"))
  ```
  
  
  
  ## Base Plot with Regression Line
  
  ```{r,fig.height=3}
  with(airquality, plot(Wind, Ozone, 
                        main = "Ozone and Wind in NYC", pch = 20))
  model <- lm(Ozone ~ Wind, airquality)
  abline(model, lwd = 2)
  ```
  
  
  
  ## Multiple Base Plots
  
  ```{r,fig.height=3,fig.width=8}
  par(mfrow = c(1, 2))
  with(airquality, {
    plot(Wind, Ozone, main = "Ozone and Wind")
    plot(Solar.R, Ozone, main = "Ozone and Solar Radiation")
  })
  ```
  
  
  
  ## Multiple Base Plots
  
  ```{r,fig.height=3,fig.width=8}
  par(mfrow = c(1, 3), mar = c(4, 4, 2, 1), oma = c(0, 0, 2, 0))
  with(airquality, {
    plot(Wind, Ozone, main = "Ozone and Wind")
    plot(Solar.R, Ozone, main = "Ozone and Solar Radiation")
    plot(Temp, Ozone, main = "Ozone and Temperature")
    mtext("Ozone and Weather in New York City", outer = TRUE)
  })
  ```
  
  
  
  ## Summary
  
  * Plots in the base plotting system are created by calling successive R functions to "build up" a plot
  
  * Plotting occurs in two stages:
    - Creation of a plot
  - Annotation of a plot (adding lines, points, text, legends)
  
  * The base plotting system is very flexible and offers a high degree of control over plotting
  
  
  ## ???????????????????????????????????????NBA...
  
  ```{r message=FALSE,warning=FALSE}
  if (!require('SportsAnalytics')){
    install.packages("SportsAnalytics")
    library(SportsAnalytics)
  }
  NBA1415<-fetch_NBAPlayerStatistics("14-15")
  ```
  
  
  ## Simple Summaries of Data - 1
  
  One dimension
  
  * Five-number summary
  * Boxplots ?????????
  * Histograms ?????????
  * Density plot ?????????
  * Barplot ?????????
  
  
  ## Five Number Summary
  
  ```{r}
  summary(NBA1415$TotalPoints)
  ```
  
  
  
  ## Boxplot ?????????
  
  ```{r}
  boxplot(NBA1415$TotalPoints, col = "blue")
  ```
  
  
  
  ## Histogram ?????????
  
  ```{r,fig.height=3.5}
  hist(NBA1415$TotalPoints, col = "green")
  ```
  
  
  
  ## Histogram ?????????
  
  ```{r,fig.height=3.5}
  hist(NBA1415$TotalPoints, col = "green")
  rug(NBA1415$TotalPoints)
  ```
  
  
  
  ## Histogram ?????????
  
  ```{r,fig.height=3.5}
  hist(NBA1415$TotalPoints, col = "green", breaks = 100)
  rug(NBA1415$TotalPoints)
  ```
  
  
  
  ## ????????? -1
  
  ```{r}
  boxplot(NBA1415$TotalPoints, col = "blue")
  abline(h = 500)
  ```
  
  
  
  
  ## ????????? -1
  
  ```{r,fig.height=3.5}
  hist(NBA1415$TotalPoints, col = "green")
  abline(v = 500, lwd = 2)
  abline(v = median(NBA1415$TotalPoints), col = "magenta", lwd = 4)
  ```
  
  
  
  ## Barplot ?????????
  
  ```{r}
  barplot(table(NBA1415$Team), 
          col = "wheat", main = "Number of Palyers in Each Team")
  ```
  
  
  
  ## Simple Summaries of Data - 2
  
  Two dimensions
  
  * Multiple/overlayed 1-D plots (Lattice/ggplot2)
  * Scatterplots
  * Smooth scatterplots
  
  $> 2$ dimensions
  
  * Overlayed/multiple 2-D plots; coplots
  * Use color, size, shape to add dimensions
  * Spinning plots
  * Actual 3-D plots (not that useful)
  
  
  
  
  ## Multiple Boxplots
  
  ```{r,fig.width=8,fig.height=3.5}
  boxplot(TotalPoints ~ Team, data = NBA1415, col = "red")
  ```
  
  
  
  ## Multiple Histograms
  
  ```{r,fig.width=8,fig.height=3.5}
  par(mfrow = c(2, 1), mar = c(4, 4, 2, 1))
  hist(subset(NBA1415, Team == "SAN")$TotalPoints, col = "green")
  hist(subset(NBA1415, Team == "GSW")$TotalPoints, col = "green")
  ```
  
  
  
  ## Scatterplot
  
  ```{r,fig.height=3}
  par(mfrow = c(1, 1))
  plot(NBA1415$TotalMinutesPlayed, NBA1415$TotalPoints)
  abline(h = 500, lwd = 2, lty = 2)
  ```
  
  
  
  ## Scatterplot - Using Color
  
  ```{r,fig.height=3}
  plot(NBA1415$TotalMinutesPlayed, NBA1415$TotalPoints,col=NBA1415$Team)
  abline(h = 500, lwd = 2, lty = 2)
  ```
  
  
  
  ## Multiple Scatterplots
  
  ```{r,fig.height=3.5,fig.width=8}
  par(mfrow = c(1, 2), mar = c(5, 4, 2, 1))
  with(subset(NBA1415, Team == "SAN"), plot(TotalMinutesPlayed, TotalPoints, main = "SAN"))
  with(subset(NBA1415, Team == "GSW"), plot(TotalMinutesPlayed, TotalPoints, main = "GSW"))
  ```
  
  
  
  ## Summary
  
  * Exploratory plots are "quick and dirty"
  
  * Let you summarize the data (usually graphically) and highlight any broad features
  
  * Explore basic questions and hypotheses (and perhaps rule them out)
  
  * Suggest modeling strategies for the "next step"
  
  
  
  
  ## Further resources
  
  * [R Graph Gallery](http://gallery.r-enthusiasts.com/)
  * [R Graph Gallery](http://www.r-graph-gallery.com/all-graphs/)
  * [R Bloggers](http://www.r-bloggers.com/)
  * [Interactive visualizations with R](http://ouzor.github.io/blog/2014/11/21/interactive-visualizations.html)
  
  
  
  
  
  # Plotting System -Lattice
  
  ## The Lattice Plotting System
  ????????????Packaes:
    
    - *lattice*: ???????????????????????????functions: `xyplot`, `bwplot`, `levelplot`
  
  - *grid*: *lattice* package ?????????
  
  - ??????????????????????????????????????????????????????
  
  
  
  ## Lattice Functions
  
  - `xyplot`: ???????????? scatterplots 
  - `bwplot`: ????????????box-and-whiskers plots (???boxplots???)
  - `histogram`: ????????? histograms
  - `stripplot`: ???????????????
  - `dotplot`:  dots on "violin strings"
  - `splom`: ??????????????????
  - `levelplot`, `contourplot`: for plotting "image" data
  
  
  
  ## Lattice Functions
  
  Lattice functions ???????????????????????? formula 
  ```r
  xyplot(y ~ x | f * g, data)
  ```
  - We use the *formula notation* here, hence the `~`.
  
  - `y~x`: y-axis~x-axis
  
  - f,g are _conditioning variables_ 
  ??? optional
  - `*`:  an interaction between two variables
  
  - ????????????????????????`data`
  
  - If no other arguments are passed, there are defaults that can be used.
  
  
  ## Simple Lattice Plot
  
  ```{r,fig.height=3.5}
  library(lattice)
  library(datasets)
  ## Simple scatterplot
  xyplot(Ozone ~ Wind, data = airquality)
  ```
  
  
  
  ## Simple Lattice Plot
  
  ```{r,fig.width=8,fig.height=3.5}
  library(datasets)
  library(lattice)
  ## Convert 'Month' to a factor variable
  airquality <- transform(airquality, Month = factor(Month)) 
  xyplot(Ozone ~ Wind | Month, data = airquality, layout = c(5, 1))
  ```
  
  ## Lattice Behavior
  
  ```{r,fig.height=3.5,fig.width=5}
  p <- xyplot(Ozone ~ Wind, data = airquality)  ## Nothing happens!
  print(p)  ## Plot appears
  ```
  ```{r,eval=FALSE}
  xyplot(Ozone ~ Wind, data = airquality)  ## Auto-printing
  ```
  
  
  
  ## Lattice Panel Functions
  
  - Lattice functions have a **panel function** which controls what
  happens inside each panel of the plot.
  
  - The *lattice* package comes with default panel functions, but you
  can supply your own if you want to customize what happens in each
  panel
  
  - Panel functions receive the x/y coordinates of the data points
  in their panel (along with any optional arguments)
  
  
  
  
  ## Lattice Panel Functions
  
  ```{r,fig.height=3.5,fig.width=8}
  set.seed(10)
  x <- rnorm(100)
  f <- rep(0:1, each = 50)
  y <- x + f - f * x+ rnorm(100, sd = 0.5)
  f <- factor(f, labels = c("Group 1", "Group 2"))
  xyplot(y ~ x | f, layout = c(2, 1))  ## Plot with 2 panels
  ```
  
  
  
  ## Lattice Panel Functions
  
  ```{r,fig.height=3}
  ## Custom panel function
  xyplot(y ~ x | f, panel = function(x, y, ...) {
    panel.xyplot(x, y, ...)  
    ## First call the default panel function for 'xyplot'
    panel.abline(h = median(y), lty = 2) 
    ## Add a horizontal line at the median
  })
  ```
  
  
  
  ## Lattice Panel Functions: Regression line
  
  ```{r,fig.height=3}
  ## Custom panel function
  xyplot(y ~ x | f, panel = function(x, y, ...) {
    panel.xyplot(x, y, ...)  
    ## First call default panel function
    panel.lmline(x, y, col = 2)  
    ## Overlay a simple linear regression line
  })
  ```
  
  
  
  ## Many Panel Lattice Plot: Example from MAACS
  
  * Study: Mouse Allergen and Asthma Cohort Study (MAACS)
  
  * Study subjects: Children with asthma living in Baltimore City, many
  allergic to mouse allergen
  
  * Design: Observational study, baseline home visit + every 3 months for a year.
  
  * Question: How does indoor airborne mouse allergen vary over time and
  across subjects?
  
  
  [Ahluwalia et al., *Journal of Allergy and Clinical Immunology*, 2013](http://www.ncbi.nlm.nih.gov/pubmed/23810154)
  
  
  
  ## Many Panel Lattice Plot
  
  ```{r,echo=FALSE,cache=TRUE,fig.width=8}
  library(lattice)
  env <- readRDS("maacs_env.rds")
  env <- transform(env, MxNum = factor(MxNum))
  xyplot(log2(airmus) ~ VisitNum | MxNum, data = env, strip = FALSE, pch = 20, xlab = "Visit Number", ylab = expression(Log[2] * "Airborne Mouse Allergen"), main = "Mouse Allergen and Asthma Cohort Study (Baltimore City)")
  ```
  
  
  
  ## Summary
  
  * Lattice plots ??????????????????????????? (e.g. `xyplot`)
  
  * ??????????????????????????????
  
  * ???????????????????????????????????????????????????????????????
  
  * ??????Panel functions????????????????????????
  